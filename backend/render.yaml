# Render Deployment Configuration - Cron Job Only
# Standalone cron job for social media publishing
# No web service needed - just cron job functionality

# Cron job service for social media publishing
cron:
  - name: mvp-social-publisher
    schedule: "* * * * *"  # Every minute (MVP frequency)
    command: |
      cd backend && \
      echo "Starting MVP cron job - $(date)"
      python -c "
      import asyncio
      import sys
      import logging

      # Configure logging for Render
      logging.basicConfig(
          level=logging.INFO,
          format='%(asctime)s - %(levelname)s - %(message)s'
      )

      try:
          from cron_job.timezone_scheduler import TimezoneAwareScheduler

          async def run_mvp_cron():
              print('MVP Cron Job Started')
              print('Configuration: 100 users Ã— 5 posts capacity')

              scheduler = TimezoneAwareScheduler()

              # Log MVP configuration
              print(f'MVP Limits - Users: {scheduler.MVP_MAX_USERS}, Posts/User: {scheduler.MVP_MAX_POSTS_PER_USER}')
              print(f'Concurrent Capacity: {sum(scheduler.PLATFORM_CONCURRENT_LIMITS.values())} posts')

              # Run the publishing logic
              published_count = await scheduler.find_scheduled_content_timezone_aware()

              if published_count > 0:
                  print(f'SUCCESS: Published {published_count} posts')
              else:
                  print('INFO: No posts due at this time')

              print('MVP Cron Job Completed Successfully')

          # Execute the cron job
          asyncio.run(run_mvp_cron())

      except Exception as e:
          print(f'ERROR in MVP cron job: {e}')
          import traceback
          traceback.print_exc()
          sys.exit(1)
      "

# Environment variables for cron job
envVars:
  - key: SUPABASE_URL
    sync: false
  - key: SUPABASE_SERVICE_ROLE_KEY
    sync: false
  - key: ENCRYPTION_KEY
    sync: false